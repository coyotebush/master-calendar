<!DOCTYPE html>

<html>
<head>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="fullcalendar/fullcalendar.js"></script>
	<script type='text/javascript' src='fullcalendar/gcal.js'></script>
	<link rel="stylesheet" type="text/css" href="fullcalendar/fullcalendar.css">
	<link rel="stylesheet" type="text/css" href="fullcalendar/fullcalendar.print.css" media="print">
	<script type="text/javascript">
		var myEventSources = [
			{
				label: 'Meals',
				url: '/commonmeals/api.php',
				color: '#006600',
				className: 'commonmeals'
			},
			{
				label: 'SLO Swing',
				url: 'https://www.google.com/calendar/feeds/gflsystems.com_kav7dpb8rmcqf6eevbibibfpes%40group.calendar.google.com/public/basic',
				color: '#550055',
				currentTimezone: 'America/Los_Angeles'
			}
		];

		$(function(){
			$("#calendar").fullCalendar({
				events: [
					{
						title: "Event 1",
						start: "2012-05-15 18:00:00",
						end: "2012-05-15 18:45:00",
					},
					{
						title: "Jazz Night Concert",
						start: "2012-05-19 20:00:00",
						end: "2012-05-15 22:00:00",
						color: "red"
					}
				],
				header: {
					left: 'today prev,next title',
					center: '',
					right: 'month,agendaWeek'
				},
				allDayDefault: false,
				defaultEventMinutes: 60,
				timeFormat: 'H:mm ',
				loading: function(state) {
					$("#loading").toggle(state);
				},
				eventClick: function(event) {
					if (event.url) {
						window.open(event.url);
						return false;
					}
				},
				eventRender: function(event, element) {
					if (event.menu) {
						$('<div><pre>' + event.menu + '</pre></div>').appendTo($(element).children().first());
					}
				},
				dayClick: function(date, allDay, jsEvent, view) {
					$("#create_menu").show('fast').css('top', jsEvent.pageY).css('left', jsEvent.pageX);
				}
				/*eventRender: function(event, element) {
			 		var eventBox = $('<div/>');
					var eventTimes = event.start.getHours() + ':' + event.start.getMinutes();
					if (event.end)
						eventTimes += '&ndash;' + event.end.getHours() + ':' + event.end.getMinutes()
					$('<div>' + eventTimes + '</div>').appendTo(eventBox);
					var eventDesc = $('<div>' + event.title + '</div>');
					if (event.color !== undefined)
						$('<span> (' + event.color + ')</span>').appendTo(eventDesc);
					eventDesc.appendTo(eventBox);
					//$("<p>Test" + event.color + "</p>").appendTo(element);
					return eventBox;
				}*/
			});

			$('#create_menu_close').click(function() {
				$(this).parent().hide();
				return false;
			});
			$(myEventSources).each(function(index) {
				$("#calendar").fullCalendar('addEventSource', this);
				var cbox = $('<input type="checkbox" checked="checked" id="source' + index + '">');
				var theSource = this;
				cbox.change(function() {
					if ($(this).is(':checked'))
						$("#calendar").fullCalendar('addEventSource', theSource);
					else
						$("#calendar").fullCalendar('removeEventSource', theSource);
				});
				var label = $('<label for="source' + index + '">' + this.label + '</label>');

				var toggler = $('<span/>').css('background-color', this.color).css('color', '#ffffff');
				toggler.append(cbox).append(label);
				$("#sources").append(toggler);
			});
			$("#refresh_link").click(function() {
				$('#calendar').fullCalendar('refetchEvents');
				return false;
			});
		});
	</script>
</head>

<body>
	<div>
		<span><a href="#" id="refresh_link">refresh</a></span>
		<span id="sources"></span>
		<span id="loading">Loading...</span>
	</div>
	<div id="calendar">

	</div>
	<div id="create_menu" style="display:none;position:absolute;background:white;z-index:10">
		Create a new:
		<ul>
			<li>Thing 1</li>
			<li>Thing 2</li>
		</ul>
		<a href="#" id="create_menu_close">close</a>
	</div>
</body>
</html>

